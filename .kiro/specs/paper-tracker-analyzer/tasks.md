# 实现计划: 论文追踪分析器

## 概述

本实现计划将论文追踪分析器系统分解为离散的编码任务。系统使用Python实现，采用模块化架构，包含配置管理、论文获取、内容提取、LLM分析和报告生成五个核心模块。每个任务都建立在前面的任务之上，确保增量进展和早期验证。

## 任务

- [x] 1. 设置项目结构和核心依赖
  - 创建项目目录结构（src/, tests/, logs/, reports/）
  - 创建requirements.txt，包含所有依赖（arxiv, pdfplumber, requests, click, PyYAML, hypothesis, pytest）
  - 创建setup.py或pyproject.toml用于包管理
  - 设置基本的日志配置
  - _需求: 7.4_

- [-] 2. 实现配置管理模块
  - [x] 2.1 创建ConfigManager类
    - 实现从YAML文件加载配置的功能
    - 实现获取LLM配置、搜索配置和输出目录的方法
    - 处理配置文件缺失的情况（使用默认值）
    - _需求: 6.1, 6.2, 6.3, 6.4_

  - [ ]* 2.2 编写ConfigManager的单元测试
    - 测试配置文件加载
    - 测试配置缺失时使用默认值
    - 测试配置文件格式错误处理
    - _需求: 6.1, 6.2, 6.3, 6.4_

  - [ ]* 2.3 编写属性测试：命令行参数覆盖配置
    - **属性 14: 命令行参数覆盖配置**
    - **验证需求: 6.5**

- [x] 3. 实现数据模型
  - [x] 3.1 创建Paper数据类
    - 定义Paper类，包含所有必需字段（arxiv_id, title, authors, published_date, summary, categories, pdf_url等）
    - 实现__str__和__repr__方法
    - _需求: 2.2_

  - [x] 3.2 创建AnalysisResult数据类
    - 定义AnalysisResult类，包含论文、分析文本、报告路径等字段
    - _需求: 5.1_

- [x] 4. 实现论文获取模块
  - [x] 4.1 创建PaperFetcher类
    - 实现search_papers方法，使用arxiv库搜索论文
    - 实现按分类和日期范围过滤
    - 实现按提交日期排序
    - 处理arXiv API错误和速率限制
    - _需求: 1.1, 1.2, 1.3, 1.4, 1.5_

  - [ ]* 4.2 编写属性测试：搜索结果领域匹配
    - **属性 1: 搜索结果领域匹配**
    - **验证需求: 1.1**

  - [ ]* 4.3 编写属性测试：搜索结果正确排序
    - **属性 2: 搜索结果正确排序**
    - **验证需求: 1.2**

  - [ ]* 4.4 编写属性测试：结果数量限制
    - **属性 3: 结果数量限制**
    - **验证需求: 1.3**

  - [ ]* 4.5 编写单元测试：arXiv API不可用
    - 测试API不可用时返回描述性错误
    - _需求: 1.4_

  - [x] 4.6 实现download_pdf方法
    - 下载论文PDF到指定目录
    - 处理下载失败的情况
    - _需求: 2.1, 2.4_

  - [ ]* 4.7 编写属性测试：PDF下载成功性
    - **属性 4: PDF下载成功性**
    - **验证需求: 2.1**

  - [ ]* 4.8 编写单元测试：下载失败继续处理
    - 测试下载失败后继续处理下一篇论文
    - _需求: 2.4_

  - [x] 4.9 实现extract_metadata方法
    - 从arxiv.Result对象提取元数据
    - 确保所有必需字段都被提取
    - _需求: 2.2_

  - [ ]* 4.10 编写属性测试：元数据提取完整性
    - **属性 5: 元数据提取完整性**
    - **验证需求: 2.2**

- [x] 5. 检查点 - 确保所有测试通过
  - 确保所有测试通过，如有问题请询问用户

- [x] 6. 实现内容提取模块
  - [x] 6.1 创建ContentExtractor类
    - 实现extract_text_from_pdf方法，使用pdfplumber提取文本
    - 处理多列布局和特殊字符
    - 处理大型PDF（超过50页时提取关键部分）
    - _需求: 2.3, 2.5_

  - [ ]* 6.2 编写属性测试：PDF文本提取非空性
    - **属性 6: PDF文本提取非空性**
    - **验证需求: 2.3**

  - [x] 6.3 实现extract_sections方法
    - 尝试识别和提取论文的关键部分（摘要、引言、结论）
    - 使用简单的启发式方法（查找标题关键词）
    - _需求: 2.5_

  - [ ]* 6.4 编写单元测试：大型PDF处理
    - 测试超过50页的PDF提取关键部分
    - _需求: 2.5_

- [x] 7. 实现LLM客户端模块
  - [x] 7.1 创建LLMClient类
    - 实现初始化方法，接受API端点、密钥和模型
    - 定义提示词模板常量
    - _需求: 3.1, 3.2, 4.1, 4.2, 4.3_

  - [ ]* 7.2 编写单元测试：提示词模板结构
    - 测试提示词模板包含所有必需部分
    - _需求: 4.1, 4.2, 4.3_

  - [x] 7.3 实现_build_prompt方法
    - 使用模板和论文数据构建完整提示词
    - 确保包含所有元数据和内容
    - _需求: 4.5_

  - [ ]* 7.4 编写属性测试：提示词包含元数据
    - **属性 9: 提示词包含元数据**
    - **验证需求: 4.5**

  - [x] 7.5 实现_call_api方法
    - 使用requests发送POST请求到LLM API
    - 实现指数退避重试逻辑（最多3次）
    - 处理超时和速率限制
    - _需求: 3.1, 3.3, 3.4, 3.5_

  - [ ]* 7.6 编写属性测试：LLM API调用格式正确性
    - **属性 7: LLM API调用格式正确性**
    - **验证需求: 3.1, 3.2**

  - [ ]* 7.7 编写属性测试：LLM响应非空性
    - **属性 8: LLM响应非空性**
    - **验证需求: 3.3**

  - [ ]* 7.8 编写单元测试：API超时重试
    - 测试API超时时的重试逻辑
    - _需求: 3.4_

  - [ ]* 7.9 编写单元测试：速率限制处理
    - 测试速率限制错误的处理
    - _需求: 3.5_

  - [x] 7.10 实现analyze_paper方法
    - 组合_build_prompt和_call_api
    - 返回LLM生成的分析文本
    - _需求: 3.1, 3.2, 3.3_

- [x] 8. 检查点 - 确保所有测试通过
  - 确保所有测试通过，如有问题请询问用户

- [x] 9. 实现报告生成模块
  - [x] 9.1 创建ReportGenerator类
    - 实现初始化方法，接受输出目录
    - 创建输出目录（如果不存在）
    - _需求: 5.1, 5.3_

  - [x] 9.2 实现generate_report方法
    - 格式化论文信息和分析结果为Markdown
    - 生成文件名（arxiv_id + sanitized_title）
    - 保存报告到文件
    - _需求: 5.1, 5.2, 5.3_

  - [ ]* 9.3 编写属性测试：报告生成成功性
    - **属性 10: 报告生成成功性**
    - **验证需求: 5.1, 5.3**

  - [ ]* 9.4 编写属性测试：报告结构完整性
    - **属性 11: 报告结构完整性**
    - **验证需求: 5.2**

  - [ ]* 9.5 编写属性测试：多论文独立报告
    - **属性 12: 多论文独立报告**
    - **验证需求: 5.4**

  - [x] 9.6 实现generate_index方法
    - 创建索引Markdown文件
    - 列出所有已处理的论文及其报告链接
    - 包含生成时间和搜索参数
    - _需求: 5.5_

  - [ ]* 9.7 编写属性测试：索引文件生成
    - **属性 13: 索引文件生成**
    - **验证需求: 5.5**

- [x] 10. 实现错误处理模块
  - [x] 10.1 创建ErrorHandler类
    - 实现handle_network_error方法
    - 实现handle_parsing_error方法
    - 实现should_retry方法
    - _需求: 7.1, 7.3_

  - [ ]* 10.2 编写属性测试：错误日志完整性
    - **属性 15: 错误日志完整性**
    - **验证需求: 7.1**

  - [ ]* 10.3 编写单元测试：网络失败日志记录
    - 测试网络失败时的日志记录
    - _需求: 7.3_

- [x] 11. 实现主程序和CLI
  - [x] 11.1 创建main函数
    - 实现完整的工作流程协调
    - 加载配置
    - 搜索论文
    - 对每篇论文：下载、提取、分析、生成报告
    - 生成索引文件
    - 输出执行摘要
    - _需求: 7.5, 8.2_

  - [ ]* 11.2 编写属性测试：关键操作日志记录
    - **属性 16: 关键操作日志记录**
    - **验证需求: 7.2**

  - [x] 11.3 使用click创建CLI接口
    - 定义命令行参数（category, days, max-results, output-dir, config）
    - 实现参数验证
    - 实现帮助信息
    - _需求: 6.5, 8.1, 8.3, 8.4_

  - [ ]* 11.4 编写单元测试：CLI帮助显示
    - 测试帮助信息显示
    - _需求: 8.3_

  - [ ]* 11.5 编写单元测试：必需参数缺失
    - 测试必需参数缺失时的错误
    - _需求: 8.4_

  - [x] 11.6 实现进度显示
    - 显示当前处理的论文和完成百分比
    - 使用tqdm或自定义进度条
    - _需求: 8.2_

  - [x] 11.7 实现退出码逻辑
    - 根据成功/失败情况返回适当的退出码
    - _需求: 8.5_

  - [ ]* 11.8 编写属性测试：退出码正确性
    - **属性 17: 退出码正确性**
    - **验证需求: 8.5**

- [x] 12. 创建配置文件示例
  - [x] 12.1 创建config.example.yaml
    - 包含所有配置选项的示例
    - 添加注释说明每个选项
    - _需求: 6.1, 6.2, 6.3_

- [x] 13. 创建文档
  - [x] 13.1 创建README.md
    - 项目简介
    - 安装说明
    - 使用示例
    - 配置说明
    - _需求: 8.1_

  - [x] 13.2 创建requirements.txt
    - 列出所有Python依赖及版本
    - _需求: 无（开发需求）_

- [x] 14. 最终检查点 - 端到端测试
  - [x] 14.1 运行完整的端到端测试
    - 使用真实的arXiv API搜索论文（少量）
    - 使用mock的LLM API生成报告
    - 验证所有文件正确生成
    - _需求: 所有需求_

  - [x] 14.2 运行所有单元测试和属性测试
    - 确保所有测试通过
    - 检查测试覆盖率（目标80%+）
    - _需求: 所有需求_

  - [x] 14.3 代码质量检查
    - 运行linter（pylint或flake8）
    - 运行类型检查（mypy）
    - 修复所有警告和错误
    - _需求: 无（代码质量）_

## 注意事项

- 标记为 `*` 的任务是可选的，可以跳过以加快MVP开发
- 每个任务都引用了特定的需求以确保可追溯性
- 检查点确保增量验证
- 属性测试验证通用正确性属性
- 单元测试验证特定示例和边缘情况
